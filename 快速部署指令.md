# 快速部署指令參考

本文件提供所有部署過程中需要的指令，方便複製貼上使用。

---

## 📦 步驟 1: 上傳到 GitHub

### 初始化並推送到 GitHub

```bash
# 1. 初始化 Git（如果還沒有）
git init

# 2. 加入所有檔案
git add .

# 3. 建立第一次提交
git commit -m "Initial commit: 家教工具庫系統"

# 4. 連結到 GitHub（替換 YOUR_USERNAME 為您的 GitHub 使用者名稱）
git remote add origin https://github.com/YOUR_USERNAME/jiaojiao-tools.git

# 5. 推送到 GitHub
git branch -M main
git push -u origin main
```

### 後續更新時使用

```bash
# 加入變更的檔案
git add .

# 提交變更
git commit -m "描述您的變更內容"

# 推送到 GitHub
git push
```

---

## 🔧 步驟 2: Render.com 環境變數

在 Render.com 控制台設定以下環境變數（直接複製貼上）：

### MONGODB_URI
```
mongodb+srv://slvhteach:Ware%40turn8888@cluster0.3r5skjs.mongodb.net/jiaojiao?retryWrites=true&w=majority&appName=Cluster0
```

### PORT
```
3000
```

### FRONTEND_URL（第一次先用這個）
```
*
```

### NODE_ENV
```
production
```

---

## 🧪 步驟 3: 測試後端 API

### 使用瀏覽器測試

開啟以下網址（替換為您的實際 Render.com 網址）：

```
https://your-app-name.onrender.com
https://your-app-name.onrender.com/api/materials
https://your-app-name.onrender.com/api/options
```

### 使用 curl 測試（進階）

```bash
# 測試主端點
curl https://your-app-name.onrender.com

# 測試獲取所有教材
curl https://your-app-name.onrender.com/api/materials

# 測試獲取選項
curl https://your-app-name.onrender.com/api/options

# 測試新增教材
curl -X POST https://your-app-name.onrender.com/api/materials \
  -H "Content-Type: application/json" \
  -d '{
    "name": "測試教具",
    "developmentStage": "學齡前兒童（3-6歲）",
    "teachingType": "個人教具",
    "material": "木製",
    "area": "日常生活區",
    "purposes": ["培養獨立性"],
    "description": "這是一個測試教具"
  }'

# 測試刪除教材（替換 MATERIAL_ID）
curl -X DELETE https://your-app-name.onrender.com/api/materials/MATERIAL_ID
```

---

## 📝 步驟 4: 更新前端 API 設定

在部署前端之前，需要先更新 API 網址。

### 4.1 修改 api-config.js

開啟 `api-config.js`，找到第 11 行，修改為：

```javascript
return 'https://your-app-name.onrender.com/api';
```

**完整範例**（替換 `jiaojiao-backend` 為您的實際名稱）：
```javascript
return 'https://jiaojiao-backend.onrender.com/api';
```

### 4.2 提交變更

```bash
git add api-config.js
git commit -m "Update API URL for production"
git push
```

---

## 🌐 步驟 5: Netlify 部署設定

### 部署設定值（在 Netlify 控制台填寫）

| 欄位 | 值 |
|------|-----|
| **Branch to deploy** | `main` |
| **Base directory** | 留空 |
| **Build command** | 留空 |
| **Publish directory** | `.` |

---

## 🔄 步驟 6: 更新 CORS 設定

當前端部署完成後，回到 Render.com 更新環境變數：

### 更新 FRONTEND_URL

將 `FRONTEND_URL` 從 `*` 改為您的實際 Netlify 網址：

```
https://your-site-name.netlify.app
```

**範例**：
```
https://jiaojiao-tools.netlify.app
```

儲存後，Render.com 會自動重新部署（約 1-2 分鐘）。

---

## 🧪 完整系統測試流程

### 1. 測試選項管理

```
1. 開啟網站
2. 點選「選項管理」
3. 確認預設選項已載入
4. 嘗試新增一個新選項
5. 重新整理頁面，確認選項還在
```

### 2. 測試教材管理

```
1. 點選「教材管理」
2. 填寫教材表單：
   - 名稱：測試教具
   - 發展階段：學齡前兒童（3-6歲）
   - 教學類型：個人教具
   - 材質：木製
   - 使用區域：日常生活區
   - 教學目的：培養獨立性
   - 描述：這是測試用的教具
3. 上傳一張照片
4. 點選「新增教材」
5. 確認教材出現在列表
6. 點選教材查看詳細資訊
7. 點選照片查看放大功能
```

### 3. 測試資料持久性

```
1. 關閉瀏覽器
2. 清除瀏覽器快取（Ctrl+Shift+Delete）
3. 重新開啟網站
4. 確認剛才新增的教材和選項都還在
```

### 4. 驗證 MongoDB 資料

```
1. 登入 MongoDB Atlas
2. 點選 Cluster0 → Browse Collections
3. 選擇 jiaojiao 資料庫
4. 檢查 materials 集合是否有資料
5. 檢查 options 集合是否有資料
```

---

## 🐛 常見問題快速修復

### 問題：前端無法連接後端

```bash
# 1. 檢查 api-config.js 的 API 網址是否正確
# 2. 檢查 Render.com 的服務狀態是否為 Live
# 3. 檢查瀏覽器控制台（F12）的錯誤訊息

# 快速修復：確認 CORS 設定
# 在 Render.com 設定 FRONTEND_URL=*（測試用）
# 如果可以連接，再改為實際的前端網址
```

### 問題：MongoDB 連線失敗

```bash
# 檢查 MongoDB Atlas 設定
# 1. Network Access → 確認有 0.0.0.0/0
# 2. Database Access → 確認使用者 slvhteach 存在
# 3. 確認密碼中的 @ 已編碼為 %40

# 測試連線字串
mongodb+srv://slvhteach:Ware%40turn8888@cluster0.3r5skjs.mongodb.net/jiaojiao?retryWrites=true&w=majority&appName=Cluster0
```

### 問題：Render.com 服務休眠

```bash
# 這是正常現象（免費方案）
# 解決方法：
# 1. 第一次訪問等待 30-60 秒
# 2. 或升級到付費方案（$7/月）
```

### 問題：Netlify 部署失敗

```bash
# 檢查 Netlify 的 Deploy log
# 常見原因：
# 1. Publish directory 設定錯誤（應該是 .）
# 2. Base directory 不應該填寫（留空）

# 快速修復：
# Site settings → Build & deploy → Edit settings
# 確認所有設定正確後重新部署
```

---

## 📊 部署檢查表

複製此檢查表，確認每個步驟都完成：

```
後端部署（Render.com）
□ GitHub Repository 已建立
□ 程式碼已推送到 GitHub
□ Render.com 帳號已註冊
□ Web Service 已建立
□ Root Directory 設定為 backend
□ 所有環境變數已設定
□ 部署狀態為 Live
□ API 端點測試通過

前端部署（Netlify）
□ api-config.js 已更新為正式 API 網址
□ 變更已推送到 GitHub
□ Netlify 帳號已註冊
□ 網站已建立並部署
□ 可以正常開啟網站
□ CORS 設定已更新為實際前端網址

功能測試
□ 選項管理功能正常
□ 教材新增功能正常
□ 教材列表顯示正常
□ 教材詳細資訊顯示正常
□ 照片上傳和顯示正常
□ 資料持久化正常（重新整理後資料還在）
□ MongoDB 中可以看到資料
```

---

## 🎉 完成！

當所有檢查項目都完成後，您的家教工具庫系統就成功部署到線上了！

### 您的系統網址

- **前端**: https://your-site-name.netlify.app
- **後端**: https://your-app-name.onrender.com
- **資料庫**: MongoDB Atlas

### 分享給其他人

現在您可以將前端網址分享給其他老師或使用者，他們就可以直接使用這個工具了！

---

## 📞 需要更多協助？

- **Render.com 文件**: https://render.com/docs
- **Netlify 文件**: https://docs.netlify.com
- **MongoDB Atlas 文件**: https://docs.atlas.mongodb.com

祝您使用愉快！ 🎊
