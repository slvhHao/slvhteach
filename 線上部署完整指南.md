# 家教工具庫 - 線上部署完整指南

本指南將協助您將「家教工具庫」系統部署到線上，讓任何人都可以透過網址存取。

## 📋 部署架構

- **後端 API**: Render.com（免費方案）
- **前端網站**: Netlify（免費方案）
- **資料庫**: MongoDB Atlas（已設定完成）

---

## 🚀 部署步驟總覽

1. 將程式碼上傳到 GitHub
2. 部署後端到 Render.com
3. 更新前端 API 設定
4. 部署前端到 Netlify
5. 測試完整系統

---

## 步驟 1: 上傳程式碼到 GitHub

### 1.1 建立 GitHub 帳號（如果還沒有）
- 前往 https://github.com
- 點選「Sign up」註冊帳號

### 1.2 建立新的 Repository
1. 登入 GitHub
2. 點選右上角的 `+` → `New repository`
3. 填寫資訊：
   - **Repository name**: `jiaojiao-tools`
   - **Description**: 家教工具庫管理系統
   - **Visibility**: 選擇 `Public`（公開）
   - 不要勾選任何初始化選項
4. 點選「Create repository」

### 1.3 上傳程式碼

在專案資料夾中打開終端機（Terminal），執行以下指令：

```bash
# 初始化 Git
git init

# 加入所有檔案
git add .

# 建立第一次提交
git commit -m "Initial commit: 家教工具庫系統"

# 連結到 GitHub（替換 YOUR_USERNAME 為您的 GitHub 使用者名稱）
git remote add origin https://github.com/YOUR_USERNAME/jiaojiao-tools.git

# 推送到 GitHub
git branch -M main
git push -u origin main
```

---

## 步驟 2: 部署後端到 Render.com

### 2.1 註冊 Render.com
1. 前往 https://render.com
2. 點選「Get Started」
3. 使用 GitHub 帳號登入（推薦）

### 2.2 建立新的 Web Service

1. 點選「New +」→「Web Service」
2. 連接 GitHub Repository:
   - 點選「Connect a repository」
   - 找到並選擇 `jiaojiao-tools`
   - 點選「Connect」

3. 設定 Web Service：
   - **Name**: `jiaojiao-backend`
   - **Region**: 選擇最近的區域（例如：Singapore）
   - **Root Directory**: `backend`（重要！）
   - **Environment**: `Node`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Instance Type**: 選擇「Free」

4. 設定環境變數（Environment Variables）：
   點選「Add Environment Variable」，加入以下變數：

   | Key | Value |
   |-----|-------|
   | `MONGODB_URI` | `mongodb+srv://slvhteach:Ware%40turn8888@cluster0.3r5skjs.mongodb.net/jiaojiao?retryWrites=true&w=majority&appName=Cluster0` |
   | `PORT` | `3000` |
   | `FRONTEND_URL` | `*` |
   | `NODE_ENV` | `production` |

5. 點選「Create Web Service」

### 2.3 等待部署完成

- 部署過程約需 3-5 分鐘
- 您會看到即時的建置日誌
- 當看到「Your service is live」表示部署成功
- 記下您的後端網址，格式類似：`https://jiaojiao-backend.onrender.com`

### 2.4 測試後端 API

在瀏覽器開啟：
```
https://jiaojiao-backend.onrender.com
```

應該會看到：
```json
{
  "message": "家教工具庫 API",
  "version": "1.0.0",
  "endpoints": {
    "materials": "/api/materials",
    "options": "/api/options"
  }
}
```

---

## 步驟 3: 更新前端 API 設定

### 3.1 修改 api-config.js

開啟 `api-config.js`，找到第 11 行：

```javascript
return 'YOUR_RENDER_API_URL_HERE';
```

替換為您的實際 Render.com 網址（加上 `/api`）：

```javascript
return 'https://jiaojiao-backend.onrender.com/api';
```

### 3.2 提交變更到 GitHub

```bash
git add api-config.js
git commit -m "Update API URL for production"
git push
```

---

## 步驟 4: 部署前端到 Netlify

### 4.1 註冊 Netlify
1. 前往 https://www.netlify.com
2. 點選「Sign up」
3. 使用 GitHub 帳號登入（推薦）

### 4.2 建立新網站

1. 點選「Add new site」→「Import an existing project」
2. 選擇「Deploy with GitHub」
3. 授權 Netlify 存取您的 GitHub
4. 選擇 `jiaojiao-tools` repository

5. 設定部署選項：
   - **Branch to deploy**: `main`
   - **Base directory**: 留空（不要填寫）
   - **Build command**: 留空
   - **Publish directory**: `.`（一個點）

6. 點選「Deploy site」

### 4.3 等待部署完成

- 部署過程約需 1-2 分鐘
- Netlify 會自動產生一個網址，格式類似：`https://random-name-123456.netlify.app`

### 4.4 自訂網域名稱（可選）

1. 在 Netlify 控制台，點選「Site settings」
2. 點選「Change site name」
3. 輸入您想要的名稱，例如：`jiaojiao-tools`
4. 網址會變成：`https://jiaojiao-tools.netlify.app`

---

## 步驟 5: 更新 Render.com 的 CORS 設定

現在您已經知道前端網址，需要更新後端的 CORS 設定。

### 5.1 更新環境變數

1. 回到 Render.com 控制台
2. 選擇您的 `jiaojiao-backend` service
3. 點選「Environment」
4. 找到 `FRONTEND_URL` 變數
5. 將值從 `*` 改為您的 Netlify 網址：
   ```
   https://jiaojiao-tools.netlify.app
   ```
6. 點選「Save Changes」
7. 服務會自動重新部署

---

## 步驟 6: 測試完整系統

### 6.1 開啟您的網站

在瀏覽器開啟您的 Netlify 網址：
```
https://jiaojiao-tools.netlify.app
```

### 6.2 測試功能

1. **測試選項管理**：
   - 點選導航列的「選項管理」
   - 確認預設選項已經載入
   - 嘗試新增一個新的發展階段
   - 確認儲存成功

2. **測試教材管理**：
   - 點選導航列的「教材管理」
   - 填寫新教材表單
   - 上傳一張照片
   - 點選「新增教材」
   - 確認教材出現在列表中
   - 點選教材查看詳細資訊
   - 點選照片確認放大功能

3. **測試資料持久性**：
   - 關閉瀏覽器
   - 重新開啟網站
   - 確認剛才新增的教材還在

### 6.3 檢查資料庫

1. 登入 MongoDB Atlas (https://cloud.mongodb.com)
2. 點選「Database」→「Browse Collections」
3. 選擇 `jiaojiao` 資料庫
4. 確認可以看到 `materials` 和 `options` 集合
5. 確認資料已經儲存

---

## 🎉 部署完成！

恭喜！您的家教工具庫系統已經成功部署到線上。

### 系統網址

- **前端網站**: https://jiaojiao-tools.netlify.app
- **後端 API**: https://jiaojiao-backend.onrender.com
- **資料庫**: MongoDB Atlas (Cluster0)

---

## 📝 重要注意事項

### 1. Render.com 免費方案限制
- 如果 15 分鐘沒有請求，服務會進入休眠
- 下次訪問時可能需要等待 30-60 秒喚醒
- 每月有 750 小時的免費使用時間（足夠個人使用）

### 2. Netlify 免費方案限制
- 每月 100GB 頻寬
- 每月 300 分鐘建置時間
- 適合個人和小型專案

### 3. MongoDB Atlas 免費方案限制
- 512MB 儲存空間
- 共享 RAM
- 適合開發和小型專案

---

## 🔄 如何更新網站

當您修改程式碼後，只需要：

```bash
# 提交變更
git add .
git commit -m "描述您的變更"
git push

# Netlify 和 Render 會自動偵測變更並重新部署
```

---

## 🐛 常見問題排解

### 問題 1: 前端無法連接到後端

**檢查事項**：
1. 確認 `api-config.js` 中的 API 網址正確
2. 確認 Render.com 後端服務狀態為「Live」
3. 開啟瀏覽器開發者工具（F12）→ Console，查看錯誤訊息
4. 確認 CORS 設定正確（FRONTEND_URL）

### 問題 2: 後端回應很慢

**原因**: Render.com 免費方案會讓閒置的服務休眠

**解決方案**:
- 第一次訪問時等待 30-60 秒
- 考慮升級到付費方案（每月 $7 起）
- 或使用其他服務（如 Railway.app）

### 問題 3: MongoDB 連線失敗

**檢查事項**：
1. 確認 MongoDB Atlas 的 IP 白名單設定為允許所有 IP（0.0.0.0/0）
2. 確認環境變數中的 MONGODB_URI 正確
3. 確認密碼中的特殊字符已正確編碼（@ → %40）

### 問題 4: 圖片無法顯示

**原因**: 圖片太大導致 Base64 字串過長

**解決方案**:
- 限制上傳圖片大小（目前限制 5MB）
- 考慮使用圖片託管服務（如 Cloudinary）

---

## 🔐 安全性建議

### 生產環境最佳實踐

1. **環境變數管理**：
   - 不要將 `.env` 檔案上傳到 GitHub
   - 使用 Render.com 的環境變數功能

2. **CORS 設定**：
   - 將 `FRONTEND_URL` 設定為您的實際前端網址
   - 不要在生產環境使用 `*`

3. **MongoDB 安全**：
   - 定期更換資料庫密碼
   - 限制 IP 白名單（如果可能）

4. **定期備份**：
   - 使用 MongoDB Atlas 的備份功能
   - 定期匯出重要資料

---

## 📞 需要協助？

如果遇到問題：

1. 檢查服務狀態：
   - Render.com: https://status.render.com
   - Netlify: https://www.netlifystatus.com
   - MongoDB Atlas: https://status.mongodb.com

2. 查看服務日誌：
   - Render.com: 控制台 → Logs
   - Netlify: 控制台 → Deploys → Deploy log

3. 檢查瀏覽器控制台的錯誤訊息（F12）

---

## 🎯 下一步

現在您的系統已經上線，可以考慮：

1. **新增使用者認證**: 讓不同老師有自己的帳號
2. **優化圖片處理**: 使用 CDN 服務
3. **新增更多功能**: 例如匯出 Excel、列印報表等
4. **效能優化**: 加入快取機制
5. **行動裝置優化**: 改善手機版的使用體驗

祝您使用愉快！ 🎉
