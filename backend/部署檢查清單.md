# Render.com 後端部署檢查清單

## ✅ 部署前準備

- [ ] 已建立 GitHub 帳號
- [ ] 已將程式碼上傳到 GitHub
- [ ] 確認 `package.json` 包含所有必要的依賴套件
- [ ] 確認 `.gitignore` 正確設定（不包含 node_modules、.env）
- [ ] 確認 MongoDB Atlas 資料庫可正常連線

## ✅ Render.com 設定

### 基本設定
- [ ] 已註冊 Render.com 帳號
- [ ] 已連接 GitHub Repository
- [ ] **Root Directory**: `backend`
- [ ] **Environment**: Node
- [ ] **Build Command**: `npm install`
- [ ] **Start Command**: `npm start`
- [ ] **Instance Type**: Free

### 環境變數（必須設定）

| 變數名稱 | 值 | 說明 |
|---------|-----|------|
| `MONGODB_URI` | `mongodb+srv://slvhteach:Ware%40turn8888@cluster0.3r5skjs.mongodb.net/jiaojiao?retryWrites=true&w=majority&appName=Cluster0` | MongoDB 連線字串 |
| `PORT` | `3000` | 伺服器埠號 |
| `FRONTEND_URL` | 先設定為 `*`，之後改為實際前端網址 | CORS 允許的來源 |
| `NODE_ENV` | `production` | 執行環境 |

**重要**：密碼中的 `@` 符號必須編碼為 `%40`

## ✅ 部署後驗證

### 1. 檢查服務狀態
- [ ] Render.com 控制台顯示「Live」
- [ ] 沒有錯誤訊息在日誌中

### 2. 測試 API 端點

開啟瀏覽器測試以下網址（替換為您的實際網址）：

#### 測試主端點
```
https://jiaojiao-backend.onrender.com
```
**預期回應**：
```json
{
  "message": "家教工具庫 API",
  "version": "1.0.0",
  "endpoints": {
    "materials": "/api/materials",
    "options": "/api/options"
  }
}
```

#### 測試 Materials 端點
```
https://jiaojiao-backend.onrender.com/api/materials
```
**預期回應**：
```json
[]
```
（空陣列，因為還沒有資料）

#### 測試 Options 端點
```
https://jiaojiao-backend.onrender.com/api/options
```
**預期回應**：
```json
{
  "_id": "...",
  "userId": "default",
  "developmentStages": [...],
  "teachingTypes": [...],
  ...
}
```

### 3. 使用 curl 測試 POST 請求（可選）

```bash
curl -X POST https://jiaojiao-backend.onrender.com/api/materials \
  -H "Content-Type: application/json" \
  -d '{
    "name": "測試教具",
    "developmentStage": "學齡前兒童（3-6歲）",
    "teachingType": "個人教具",
    "material": "木製",
    "area": "日常生活區",
    "purposes": ["培養獨立性"],
    "description": "這是一個測試教具"
  }'
```

**預期回應**：應該回傳新建立的教材物件

## ✅ MongoDB Atlas 設定檢查

- [ ] 資料庫使用者已建立（slvhteach）
- [ ] Network Access 設定為允許所有 IP（0.0.0.0/0）
- [ ] 資料庫名稱為 `jiaojiao`
- [ ] 可以在 MongoDB Atlas 看到 `materials` 和 `options` 集合

## 🐛 常見問題排解

### 問題：無法連線到 MongoDB

**檢查**：
1. MongoDB Atlas → Network Access → 確認 IP 白名單包含 `0.0.0.0/0`
2. 確認 MONGODB_URI 環境變數正確
3. 確認密碼特殊字符已編碼（@ → %40）

**解決方法**：
```bash
# 在 Render.com 控制台的 Logs 中查看詳細錯誤訊息
```

### 問題：服務啟動失敗

**檢查**：
1. Render.com → Logs → 查看錯誤訊息
2. 確認 `package.json` 中的 dependencies 完整
3. 確認 `npm start` 指令正確

**解決方法**：
```bash
# 在 Render.com 手動觸發重新部署
# Dashboard → Manual Deploy → Deploy latest commit
```

### 問題：CORS 錯誤

**檢查**：
1. 確認 FRONTEND_URL 環境變數已設定
2. 確認前端網址與 FRONTEND_URL 一致

**解決方法**：
```bash
# 暫時設定 FRONTEND_URL=* 測試
# 確認問題解決後，改為實際的前端網址
```

### 問題：服務休眠（回應慢）

**說明**：
- Render.com 免費方案會在 15 分鐘無活動後讓服務休眠
- 下次請求時需要 30-60 秒喚醒

**解決方法**：
- 耐心等待第一次請求完成
- 或升級到付費方案（$7/月起）

## 📝 部署後需要做的事

1. **記錄 API 網址**：
   ```
   https://your-app-name.onrender.com
   ```

2. **更新前端設定**：
   - 修改 `api-config.js` 中的 API 網址
   - 提交變更到 GitHub

3. **更新 CORS 設定**：
   - 將 `FRONTEND_URL` 從 `*` 改為實際的前端網址
   - 儲存後服務會自動重新部署

4. **測試完整流程**：
   - 確認前端可以正常呼叫後端 API
   - 測試新增、查詢、刪除功能
   - 確認資料有儲存到 MongoDB

## 🎯 完成！

當所有項目都打勾後，您的後端就成功部署了！

下一步：部署前端到 Netlify
