# 後端伺服器快速啟動指南

## ✅ 已完成

- ✅ npm install 已完成
- ✅ 所有套件已安裝
- ✅ .env 檔案已建立

## 📝 接下來的步驟

### 步驟 1：設定 MongoDB Atlas 連接字串

1. **如果還沒有 MongoDB Atlas 帳號：**
   - 前往 https://www.mongodb.com/cloud/atlas
   - 註冊免費帳號
   - 建立免費集群（選擇 AWS Tokyo 或 Singapore）
   - 建立資料庫使用者和密碼
   - 設定 Network Access（允許所有 IP：0.0.0.0/0）
   - 取得連接字串

2. **編輯 `.env` 檔案：**
   - 打開 `backend/.env` 檔案
   - 將 `MONGODB_URI` 的值改為您的實際連接字串

   範例：
   ```env
   MONGODB_URI=mongodb+srv://myuser:mypassword123@cluster0.abcde.mongodb.net/jiaojiao?retryWrites=true&w=majority
   ```

   **重要：**
   - 替換 `myuser` 為您的使用者名稱
   - 替換 `mypassword123` 為您的密碼
   - `jiaojiao` 是資料庫名稱（可保持不變）

### 步驟 2：啟動伺服器

在 `backend` 資料夾中執行：

**開發模式（自動重啟）：**
```bash
npm run dev
```

**或正式模式：**
```bash
npm start
```

### 步驟 3：確認伺服器運行

如果看到以下訊息表示成功：
```
✅ MongoDB 連接成功
🚀 伺服器運行在 http://localhost:3000
📝 API 文件：http://localhost:3000
```

### 步驟 4：測試 API

在瀏覽器中開啟：
- http://localhost:3000 （應該看到 API 資訊）
- http://localhost:3000/api/materials （應該看到空陣列 []）

---

## ❌ 常見問題

### 問題 1：連接 MongoDB 失敗

**錯誤訊息：** `MongoServerError: bad auth`
**解決方法：**
- 檢查使用者名稱和密碼是否正確
- 確認密碼中的特殊字元有正確編碼

**錯誤訊息：** `MongooseServerSelectionError`
**解決方法：**
- 確認 Network Access 已設定為允許所有 IP（0.0.0.0/0）
- 檢查網路連接

### 問題 2：埠號被占用

**錯誤訊息：** `Error: listen EADDRINUSE: address already in use :::3000`
**解決方法：**
- 更改 `.env` 中的 `PORT=3001`
- 或關閉占用 3000 埠的其他程式

### 問題 3：找不到 .env 檔案

**錯誤訊息：** `MONGODB_URI is undefined`
**解決方法：**
- 確認 `.env` 檔案在 `backend/` 資料夾中
- 確認檔案名稱是 `.env` 不是 `.env.txt`

---

## 🧪 測試 API（使用 PowerShell 或 CMD）

### 取得所有教具
```powershell
curl http://localhost:3000/api/materials
```

### 新增教具
```powershell
curl -X POST http://localhost:3000/api/materials -H "Content-Type: application/json" -d "{\"name\":\"測試教具\",\"developmentStage\":\"學齡前兒童（3-6歲）\",\"teachingType\":\"個人教具\",\"material\":\"木製\",\"area\":\"數學區\",\"purposes\":[\"數學邏輯\"]}"
```

### 取得選項
```powershell
curl http://localhost:3000/api/options
```

---

## 📊 已安裝的套件

- **express** (4.21.2) - Web 框架
- **mongoose** (8.19.2) - MongoDB ODM
- **cors** (2.8.5) - 跨域資源共享
- **dotenv** (16.6.1) - 環境變數管理
- **nodemon** (3.1.10) - 開發時自動重啟

---

## 🎯 下一步

伺服器成功運行後：

1. **本地測試完成** → 部署到 Render.com（免費）
2. **修改前端** → 讓網站使用 API 而非 localStorage
3. **部署前端** → Netlify 或 GitHub Pages

---

## 📞 需要協助？

如果遇到任何問題：
1. 檢查終端機的錯誤訊息
2. 確認 MongoDB Atlas 設定正確
3. 確認 .env 檔案內容正確
